# Generated by ChatGPT
# Use a minimal base image
FROM alpine:3.18

# Install OpenSSH server and create test user
RUN apk add --no-cache openssh && \
    adduser -D -g '' test && \
    echo "test:test" | chpasswd

# Enable password authentication in SSH server
RUN sed -i 's/#PasswordAuthentication no/PasswordAuthentication yes/' /etc/ssh/sshd_config

# Generate SSH keys for the server
RUN ssh-keygen -t rsa -f /etc/ssh/ssh_host_rsa_key -N '' && \
    ssh-keygen -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key -N '' && \
    ssh-keygen -t ed25519 -f /etc/ssh/ssh_host_ed25519_key -N ''

# Install dependencies (imagemagick and font packages)
RUN apk add --no-cache imagemagick fontconfig ttf-dejavu

# Copy the script that generates PNG images
COPY generate_images.sh /usr/local/bin/generate_images.sh

# Run the script to generate PNG images and place them in test's home folder
RUN chmod +x /usr/local/bin/generate_images.sh && \
    su -c "/usr/local/bin/generate_images.sh" test

# Expose SSH port
EXPOSE 22

# Start the SSH server
CMD ["/usr/sbin/sshd", "-D"]
